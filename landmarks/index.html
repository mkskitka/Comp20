<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href= "style.css"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
/*<link rel="stylesheet" href="geolocation map style.css"/>*/

	var map;
	var data;
	var raw;
	var name = "EDMUND_ROMERO";
	var url = "https://defense-in-derpth.herokuapp.com/sendLocation";
	var myLat = 0;
	var myLng = 0;
	var me = new google.maps.LatLng(myLat, myLng);
	var request = new XMLHttpRequest();
	var marker;
	var min;
	
	   
	function init() {
		latlng = new google.maps.LatLng(myLat, myLng);
		var myOptions = {
			center: me,
			zoom: 15,
			mapTypeId: google.maps.MapTypeId.ROADMAP
			};
		map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		getMyLocation();

	}

	function getMyLocation() {
		if (navigator.geolocation) { // the navigator.geolocation object is supported on your browser
			navigator.geolocation.getCurrentPosition(function(position) {
				myLat = position.coords.latitude;
				myLng = position.coords.longitude;
				console.log(myLat, myLng);
				me = new google.maps.LatLng(myLat, myLng);
									//centers map to my location
				map.panTo(me);
				console.log("hi");
				var params = "login=" + name + "&lat=" + String(myLat) + "&lng=" + String(myLng);
				request.open("POST", url, true);
				request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				request.send(params);
				request.onreadystatechange = function(){
					if(request.readyState == 4 && request.status == 200){
						var raw = request.responseText;
						var data = JSON.parse(raw);
						console.log(data);
						setMarkers(data);
					}
				}
			});
		}
		else {
			alert("Geolocation is not supported by your web browser.  What a shame!");
		}
	}
	
	function setMarkers(data){	
		var image = {
    		url: 'nerd.png',
    		scaledSize: new google.maps.Size(30, 30),
    		origin: new google.maps.Point(0, 0),
    		anchor: new google.maps.Point(20, 32)
  		};
  		var image2 = {
    		url: 'landmark.png',
    		scaledSize: new google.maps.Size(30, 30),
    		origin: new google.maps.Point(0, 0),
    		anchor: new google.maps.Point(20, 32)
  		};
  		var shape = {
    		coords: [1, 1, 1, 20, 18, 20, 18, 1],
    		type: 'poly'
  		};			
		for(i = 0; i < data["people"].length; i++){
			if(data["people"][i].login == name){
				var image3 = {
    				url: 'yo.jpg',
    				scaledSize: new google.maps.Size(30, 30),
    				origin: new google.maps.Point(0, 0),
    				anchor: new google.maps.Point(20, 32)
  				};
  				  var shape = {
    				coords: [1, 1, 1, 20, 18, 20, 18, 1],
    				type: 'poly'
  				};
				var marker = new google.maps.Marker({ //creates my marker
					position: me,
					title: "ME",
					shape:shape,
					icon: image3,
					zIndex: google.maps.Marker.MAX_ZINDEX + 1,
					content: "Ming was here",
				});
				var infoWindow = new google.maps.InfoWindow();
    			google.maps.event.addListener(marker, 'click', function () {
                                infoWindow.setContent(this.content);
                                infoWindow.open(this.getMap(), this);
            });
				marker.setMap(map);			
				}
			}
		}


</script>
<head/>
<body onload="init()">
	<div id="map_canvas" style="width:100%; height:100%"</div>
</body>
</html>
